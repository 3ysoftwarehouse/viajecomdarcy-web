{% extends "default/panel/layout.html" %}
{% load staticfiles %}

{% block page_info %}
    <li>
      <b>Pacote</b>
    </li>
    <li>
      <a class="active">Cadastro</a>
    </li>    
{% endblock %}

{% block content %}
  <div class="col-md-12">
  <!-- START PANEL -->
  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">
      </div>
    </div>
    <div class="panel-body">
      <form autocomplete="off"  method="post" enctype="multipart/form-data" role="form" id="form-personal" novalidate="novalidate">
        {% csrf_token %}
        <div class='row'>
           <div class="col-lg-4">
            <fieldset class="form-group">
              <label class="form-label semibold" for="{{ form.pacote_nome.auto_id }}">{{ form.pacote_nome.label_tag }}</label>
              {{ form.pacote_nome }}
              <small class="text-muted">{{ form.pacote_nome.errors }}</small>
            </fieldset>
          </div>
           <div class="col-lg-4">
            <fieldset class="form-group">
              <label class="form-label semibold" for="{{ form.pacote_desc.auto_id }}">{{ form.pacote_desc.label_tag }}</label>
              {{ form.pacote_desc }}
              <small class="text-muted">{{ form.pacote_desc.errors }}</small>
            </fieldset>
          </div>
           <div class="col-lg-4">
            <fieldset class="form-group">
              <label class="form-label semibold" for="{{ form.id_excursao.auto_id }}">{{ form.id_excursao.label_tag }}</label>
              {{ form.id_excursao }}
              <small class="text-muted">{{ form.id_excursao.errors }}</small>
            </fieldset>
          </div>
        </div>

        <div class='row'>
           <div class="col-lg-4">
            <fieldset class="form-group">
              <label class="form-label semibold" for="{{ form.id_moeda.auto_id }}">{{ form.id_moeda.label_tag }}</label>
              {{ form.id_moeda }}
              <small class="text-muted">{{ form.id_moeda.errors }}</small>
            </fieldset>
          </div>
           <div class="col-lg-4">
            <fieldset class="form-group">
              <label class="form-label semibold" for="{{ form.pacote_preco.auto_id }}">{{ form.pacote_preco.label_tag }}</label>
              {{ form.pacote_preco }}
              <small class="text-muted">{{ form.pacote_preco.errors }}</small>
            </fieldset>
          </div>
          <div class="col-lg-2">
            <fieldset class="form-group">
              <label class="form-label semibold" for="{{ form.pacote_taxa.auto_id }}">{{ form.pacote_taxa.label_tag }}</label>
              {{ form.pacote_taxa }}
              <small class="text-muted">{{ form.pacote_taxa.errors }}</small>
            </fieldset>
          </div>
          <div class="col-lg-2">
            <fieldset class="form-group">
              <label class="form-label semibold" for="{{ form.taxa_remessa.auto_id }}">{{ form.taxa_remessa.label_tag }}</label>
              {{ form.taxa_remessa }}
              <small class="text-muted">{{ form.taxa_remessa.errors }}</small>
            </fieldset>
          </div>
        </div>

        <div class='row'>
           <div class="col-lg-4">
            <fieldset class="form-group">
              <label class="form-label semibold" for="{{ form.data_prevista.auto_id }}">{{ form.data_prevista.label_tag }}</label>
              <input type="text" value="{{form.data_prevista.value|date:'d/m/Y' }}" placeholder="__/__/__" name="data_prevista" id="id_data_prevista" class="form-control">
              <small class="text-muted">{{ form.data_prevista.errors }}</small>
            </fieldset>
          </div>
          <div class="col-lg-4">
            <fieldset class="form-group">
              <br>
              <div class="checkbox check-success  ">
                  {{ form.is_active }}
                  <label for="{{ form.is_active.auto_id }}">Ativo </label>
                </div>
              <small class="text-muted">{{ form.is_active.errors }}</small>
            </fieldset>
          </div>
        </div>

        <div class='row'>
           <div class="col-lg-12">
            <fieldset class="form-group">
              <label class="form-label semibold" for="{{ form.pacote_daybyday.auto_id }}">{{ form.pacote_daybyday.label_tag }}</label>
              {{ form.pacote_daybyday }}
              <small class="text-muted">{{ form.pacote_daybyday.errors }}</small>
            </fieldset>
          </div>          
        </div>


        <div class='row'>
           <div class="col-lg-12">
            <fieldset class="form-group">
              <label class="form-label semibold" for="{{ form.pacote_obs.auto_id }}">{{ form.pacote_obs.label_tag }}</label>
              {{ form.pacote_obs }}
              <small class="text-muted">{{ form.pacote_obs.errors }}</small>
            </fieldset>
          </div>          
        </div>

        <div class='row'>
           <div class="col-lg-12">
            <fieldset class="form-group">
              <label class="form-label semibold" for="{{ form.id_opcional.auto_id }}">{{ form.id_opcional.label_tag }}</label>
              {{ form.id_opcional }}
              <small class="text-muted">{{ form.id_opcional.errors }}</small>
            </fieldset>
          </div>          
        </div>

        <div class='row'>
           <div class="col-lg-12">
            <div id="id_cidade_table" class="row form-group-attached p-t-10" >
              {% for form in cidadeformset.forms %}
                <div id="{{ form.prefix }}-row" class="tr form-group-attached">
                  <div class="col-lg-6">
                    <fieldset class="form-group">
                      <label class="form-label semibold" for="{{ form.id_cidade.auto_id }}">{{ form.id_cidade.label_tag }}</label>
                      {{ form.id_cidade }}
                      <small class="text-muted">{{ form.id_cidade.errors }}</small>
                    </fieldset>
                  </div>
                  <div class="col-lg-6">
                    <fieldset class="form-group">
                      <label class="form-label semibold" for="{{ form.qtd_dias.auto_id }}">{{ form.qtd_dias.label_tag }}</label>
                      {{ form.qtd_dias }}
                      <small class="text-muted">{{ form.qtd_dias.errors }}</small>
                    </fieldset>
                  </div>
                </div>
                {% endfor %}
                {{ cidadeformset.management_form }}           
            </div>
          </div>          
        </div>

        <br>
        <div class='row'>
           <div class="col-lg-12">
            <div id="id_acomodacao_table" class="row form-group-attached p-t-10" >
              {% for form in acomodacaoformset.forms %}
                <div id="{{ form.prefix }}-row" class="tr form-group-attached">
                  <div class="col-lg-6">
                    <fieldset class="form-group">
                      <label class="form-label semibold" for="{{ form.id_acomodacao.auto_id }}">{{ form.id_acomodacao.label_tag }}</label>
                      {{ form.id_acomodacao }}
                      <small class="text-muted">{{ form.id_acomodacao.errors }}</small>
                    </fieldset>
                  </div>
                  <div class="col-lg-6">
                    <fieldset class="form-group">
                      <label class="form-label semibold" for="{{ form.preco.auto_id }}">{{ form.preco.label_tag }}</label>
                      {{ form.preco }}
                      <small class="text-muted">{{ form.preco.errors }}</small>
                    </fieldset>
                  </div>
                </div>
                {% endfor %}
                {{ acomodacaoformset.management_form }}           
            </div>
          </div>          
        </div>

        <div class="row">
          <div class="col-lg-12">
            <div class="form-group">
              <button type="submit" class="btn btn-success btn-cons">
                Salvar
              </button>
              <div class="pull-right">
              <a class="btn btn-secondary-outline" href="{% url 'pacote-list' %}">
                Cancelar
              </a>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
  <!-- END PANEL -->
</div>
<div id="select_aux" style="display:none;"></div>
{% endblock %}


{% block javascript %}


<script src="{% static 'js/default/jquery.inputmask.min.js' %}" type="text/javascript"></script>
<script src="{% static 'js/default/form_wizard.js' %}" type="text/javascript"></script>
<script src="{% static 'js/default/jquery.bootstrap.wizard.min.js' %}" type="text/javascript">
</script>
<script src="{% static 'js/default/bootstrap-datepicker.js' %}" type="text/javascript"></script>
<script src="{% static 'js/default/custom.js' %}" type="text/javascript"></script>
<script>
  $(document).ready(function() {

    $("#id_id_opcional").select2();
    $('#id_data_prevista').mask("99/99/9999");

    $(function() {

      $('#id_cidade_table .tr').formset({
          prefix: '{{ cidadeformset.prefix }}'
      });
      $('#id_acomodacao_table .tr').formset({
          prefix: '{{ acomodacaoformset.prefix }}'
      });
      $(".acomodacao").focus(function(){
        aux_select(this.value, this.options[this.selectedIndex].text)
      });
      $(".acomodacao").change(function(){
        check_select('update');
      });
      $(".add-row").click(function(){
        check_select('add');
      });

    });

  });

  function aux_select(value, text){
    document.getElementById("select_aux").innerHTML = value + "|" + text
  }

  function check_select(type){
    var selects = document.getElementsByClassName("acomodacao");
    console.log(type)

    // UPDATE OR DELETE
    if(type == 'update' || type == 'delete'){
      
      var aux = document.getElementById("select_aux").innerHTML.split('|')
      var element = document.createElement("option")
      element.value = aux[0]
      element.text = aux[1]

      for(x=0;x<selects.length;x++){
        var select = selects[x]
        var search = false
        for(y=0;y<select;y++){
          var option = select[y]
          if(option.text == element.text){
            console.log(true)
            search = true
            break
          }
        }
        if(!search && selects.length>1){
          console.log(false)
          select.add(element)
        }
      }

    }else{

      for(x=0;x<selects.length;x++){
        if(selects[x].selectedIndex != 0){
          var element = selects[x][selects[x].selectedIndex]
          for(y=x+1;y<selects.length;y++){
            var select = selects[y]
            for(z=0;z<select.length;z++){
              var option = select[z]
              if(option.text == element.text){
                select.remove(option.index)
                break
              }
            }
          }
        }
      }

    }
  }

</script>
{% endblock %}